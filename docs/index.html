<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<title>Mini DAYZ</title>
	
	<!-- Standardised web app manifest -->
	<link rel="manifest" href="appmanifest.json" />
	
	<!-- Allow fullscreen mode on iOS devices. (These are Apple specific meta tags.) -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, minimal-ui" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<link rel="apple-touch-icon" sizes="256x256" href="icon-256.png" />
	<meta name="HandheldFriendly" content="true" />
	
	<!-- Chrome for Android web app tags -->
	<meta name="mobile-web-app-capable" content="yes" />
	<link rel="shortcut icon" sizes="256x256" href="icon-256.png" />

    <!-- All margins and padding must be zero for the canvas to fill the screen. -->
	<style type="text/css">
		* { padding: 0; margin: 0; }
		html, body {
			background: #000; color: #fff; overflow: hidden;
			touch-action: none; -ms-touch-action: none;
		}
		canvas { touch-action-delay: none; touch-action: none; -ms-touch-action: none; }
    </style>
</head> 
<body> 
	<div id="fb-root"></div>
	
	<div id="c2canvasdiv">
		<!-- The canvas the project will render to. -->
		<canvas id="c2canvas" width="1024" height="768">
			<h1>Your browser does not appear to support HTML5.  Try upgrading your browser to the latest version.  <a href="http://www.whatbrowser.org">What is a browser?</a>
			<br/><br/><a href="http://www.microsoft.com/windows/internet-explorer/default.aspx">Microsoft Internet Explorer</a><br/>
			<a href="http://www.mozilla.com/firefox/">Mozilla Firefox</a><br/>
			<a href="http://www.google.com/chrome/">Google Chrome</a><br/>
			<a href="http://www.apple.com/safari/download/">Apple Safari</a></h1>
		</canvas>
	</div>
	
	<!-- Pages load faster with scripts at the bottom -->
	
	<!-- Construct 2 exported games require jQuery. -->
	<script src="jquery-3.4.1.min.js"></script>

    <!-- The runtime script. -->
	<script src="c2runtime.js"></script>

   
<script>
  // Start + uhvati Construct 2 runtime pa ga spremi u window.__rt
  jQuery(document).ready(function () {

    // presretnemo originalnu funkciju da zabilježimo runtime odmah
    var __origCreate = window.cr_createRuntime;
    if (typeof __origCreate === 'function') {
      window.cr_createRuntime = function () {
        var res = __origCreate.apply(this, arguments);
        try {
          window.__rt =
            (typeof window.cr_getC2Runtime === 'function' && window.cr_getC2Runtime()) ||
            (window.cr && window.cr.runtime) || null;
          console.log('[hook] runtime captured (wrap):', !!window.__rt);
        } catch (e) {}
        return res;
      };
    }

    // pokreni igru
    cr_createRuntime("c2canvas");

    // rezervni pokušaj: kratko “pollaj” dok se runtime ne pojavi
    (function wait(n){
      try {
        if (!window.__rt) {
          if (typeof window.cr_getC2Runtime === 'function') window.__rt = window.cr_getC2Runtime();
          else if (window.cr && window.cr.runtime)           window.__rt = window.cr.runtime;
        }
        if (window.__rt) { console.log('[hook] runtime captured (poll):', true); return; }
      } catch(e) {}
      if ((n||0) < 60) setTimeout(function(){ wait((n||0)+1); }, 100);
      else console.warn('[hook] runtime not captured');
    })();

  });
</script>

	<!-- PATCH 1: Otključaj SVE likove (ostalo ostaje) -->
	<script>
	(function(){
	  const PREFERRED_CHAR = null; // npr. 20 ako želiš auto-odabir lika #20

	  function unlockAllCharacters(){
	    try{
	      const open = indexedDB.open('localforage');
	      open.onsuccess = () => {
	        const db = open.result;
	        if (!db.objectStoreNames.contains('keyvaluepairs')) { db.close(); return; }

	        const tx = db.transaction(['keyvaluepairs'], 'readwrite');
	        const store = tx.objectStore('keyvaluepairs');
	        const changed = [];

	        store.openCursor().onsuccess = ev => {
	          const cursor = ev.target.result;
	          if (!cursor) return;

	          const k = String(cursor.key);
	          const isCharNum = /^char_\d+$/.test(k);
	          const isAggregate = (k === 'Characters_unlocks');

	          if (isCharNum || isAggregate) {
	            cursor.update(1);
	            changed.push(k);
	          }

	          if (PREFERRED_CHAR !== null && k === 'Player_skin') {
	            cursor.update(String(PREFERRED_CHAR));
	            changed.push(k + ' -> ' + PREFERRED_CHAR);
	          }

	          cursor.continue();
	        };

	        tx.oncomplete = () => { console.log('[patch] unlocked characters:', changed.length); db.close(); };
	        tx.onerror    = () => { console.warn('[patch] characters tx error', tx.error); db.close(); };
	      };
	      open.onerror = () => { console.warn('[patch] cannot open localforage (chars)', open.error); };
	    }catch(e){ console.warn('[patch] unlockAllCharacters error', e); }
	  }

	  // Pokreni više puta (engine ponekad kasnije piše vrijednosti)
	  unlockAllCharacters();
	  setTimeout(unlockAllCharacters, 500);
	  setTimeout(unlockAllCharacters, 1500);
	  setTimeout(unlockAllCharacters, 3000);
	})();
	</script>

	<!-- PATCH 2: Otključaj SVA oružja i iteme (ostali podaci se spremaju normalno) -->
	<script>
	(function(){
	  function unlockAllItemsWeapons(){
	    try{
	      const req = indexedDB.open('localforage');
	      req.onsuccess = () => {
	        const db = req.result;
	        if (!db.objectStoreNames.contains('keyvaluepairs')) { db.close(); return; }

	        const tx = db.transaction(['keyvaluepairs'], 'readwrite');
	        const store = tx.objectStore('keyvaluepairs');
	        const changed = [];

	        store.openCursor().onsuccess = (ev) => {
	          const cur = ev.target.result;
	          if (!cur) return;

	          const k = String(cur.key);
	          const v = cur.value;

	          // Preskoči ključeve za likove (riješava prvi patch)
	          const isCharKey      = /^char_\d+$/i.test(k) || k === 'Characters_unlocks';
	          const isUnlockFlag   = /(^|_)unlock(_|$)/i.test(k);    // npr. "svd_unlock", "aug_unlock"
	          const isUnlockProg   = /unlock_progress/i.test(k);     // npr. "svd_unlock_progress"

	          if (!isCharKey && (isUnlockFlag || isUnlockProg)) {
	            const newVal = (typeof v === 'string')
	              ? (isUnlockProg ? '999' : '1')   // string
	              : (isUnlockProg ?  999  :  1 );  // number
	            cur.update(newVal);
	            changed.push([k, newVal]);
	          }

	          cur.continue();
	        };

	        tx.oncomplete = () => { console.log('[patch] items/weapons unlocked:', changed.length, 'keys'); db.close(); };
	        tx.onerror    = () => { console.warn('[patch] items tx error', tx.error); db.close(); };
	      };
	      req.onerror = () => console.warn('[patch] cannot open localforage (items)', req.error);
	    }catch(e){ console.warn('[patch] unlockAllItemsWeapons error', e); }
	  }

	  // Pokreni više puta da pregazimo kasnija upisivanja enginea
	  unlockAllItemsWeapons();
	  setTimeout(unlockAllItemsWeapons, 500);
	  setTimeout(unlockAllItemsWeapons, 1500);
	  setTimeout(unlockAllItemsWeapons, 3000);
	})();
	</script>

</body> 
</html>
